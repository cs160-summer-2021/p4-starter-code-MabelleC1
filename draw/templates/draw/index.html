{% load static %}

<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  	<title>CurrP4 Coloring</title>
      <link rel="stylesheet" type="text/css" href="{% static 'draw/vendor/bootstrap/css/bootstrap.min.css' %}">
      <script type="text/javascript" src="{% static 'draw/vendor/jquery/jquery-3.3.1.min.js' %}"></script>
      <script type="text/javascript" src="{% static 'draw/vendor/paper/paper-full.min.js' %}"></script>
  
	<style type="text/css">
		#SimpleMap {
			padding-left: 0;
		    padding-right: 0;
		    margin-left: auto;
		    margin-right: auto;
            margin-top: 20vh;
		    display: block;
		}
	</style>
</head>
<body>
    <svg id = "SimpleMap" width="294" height="405" viewBox="0 0 294 405" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect id="RoomA" x="28" y="2" width="237" height="105" fill="#EF5DA8" stroke="black" stroke-width="4"/>
        <rect id="RoomB" x="2" y="107" width="290" height="296" fill="#2D8CE3" stroke="black" stroke-width="4"/>
        <rect id="A1" x="75" y="41" width="46" height="31" fill="#F178B6" stroke="black" stroke-width="4"/>
        <rect id="A2" x="173" y="41" width="46" height="31" fill="#FCDDEC" stroke="black" stroke-width="4"/>
        <rect id="B1" x="59" y="171" width="176" height="31" fill="96DB60" stroke="black" stroke-width="4"/>
        <rect id="B2" x="59" y="239" width="176" height="31" fill="#F79854" stroke="black" stroke-width="4"/>
        <rect id="B3" x="59" y="307" width="176" height="31" fill="#A5A6F6" stroke="black" stroke-width="4"/>
    </svg>
	<script type="text/javascript" canvas="canvas">
        
        function init(){
            const buildingGroups = new Map();
            buildingGroups.set('#A1', [1,5]); 
            buildingGroups.set('#A2', [3,5]);  
            buildingGroups.set('#B1', [4,5]);  
            buildingGroups.set('#B2', [2,5]); 
            buildingGroups.set('#B3', [1,5]); 
            
            var url = window.location.href;
            var queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            const size = urlParams.get('size');
            const building = urlParams.get('building');
            
            return [buildingGroups, size, building];
        }

        function updateBoxes(buildingGroups){
            for (let [key, value] of buildingGroups){
                var rectbox = document.querySelector(key);
                var color = float2color(1-(value[0]/value[1]));//some function that counts how many people are present;
                rectbox.setAttribute("fill", color);
            }
        }

        //Link to where I foudn the code
        function float2color( percentage ) {
            var color_part_dec = 255 * percentage;
            var color_part_hex = Number(parseInt( color_part_dec , 10)).toString(16);
            return "#" + color_part_hex + color_part_hex + color_part_hex;
        }

        let groupOfObjects = init();
        const buildingGroups = groupOfObjects[0];
        const size = groupOfObjects[1];
        const building = groupOfObjects[2];

        if (size == "large"){
            updateBoxes(buildingGroups);
        }

        var socket = new WebSocket(
        'ws://' + window.location.host + '/ws/draw');

        window.onload = function() {
            if (size == "small"){
                socket.send("{\"building\" : " + JSON.stringify(building) + "}" );
            }
        
        socket.onmessage = function(receivedMessage) {
        var received = JSON.parse(receivedMessage.data);
        if (size == "large"){
                var strform = "#"+received.building;
                var updatedvalue = buildingGroups.get(strform)[0]+1;
                buildingGroups.set(strform, [updatedvalue, buildingGroups.get(strform)[1]]);
                updateBoxes(buildingGroups);
        }
        // You will probably want to add some code here to draw more lines.
    }
}

    socket.onclose = function(e) {
        console.error('Chat socket closed unexpectedly');
    };
	</script>
</body>
</html>